<!DOCTYPE html>
<head>
    <meta charset="utf-8">

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="css/plugins/switchery/switchery.css" rel="stylesheet">
    <link href="css/plugins/ionRangeSlider/ion.rangeSlider.skinHTML5.css" rel="stylesheet">
    <link href="css/plugins/ionRangeSlider/ion.rangeSlider.css" rel="stylesheet">
    <!--<link href="css/plugins/ionRangeSlider/ion.rangeSlider.skinFlat.css" rel="stylesheet">-->

    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/simulator.css" /><!--自定义样式-->
    <link rel="icon" href="images/favicon.png" />
    <script src="dist/main.js"></script>
    <link rel="stylesheet" href="css/dat-gui.css" />
    <title>Tongji Traffic Simulator</title>
</head>
<body>
    <div id="wrapper">
        <nav class="navbar-default navbar-static-side" role="navigation">
            <div class="sidebar-collapse">
                <ul class="nav" id="side-menu">
                    <li class="nav-header">
                        <div class="dropdown profile-element"> <span>
                            <img alt="Tongji University" src="images/tongji.jpg" width="100%" />
                             </span>
                            <a data-toggle="dropdown" class="dropdown-toggle" href="index.html#">
                            <span class="clear"> <span class="block m-t-xs"> <strong class="font-bold">Tongji Traffic Simulator</strong></span>
                            <span class="text-muted text-xs block">min.zhu <b class="caret"></b></span> </span> </a>
                            <ul class="dropdown-menu animated fadeInRight m-t-xs">
                                <li><a href="profile.html">Profile</a></li>
                                <li><a href="contacts.html">Contacts</a></li>
                                <li><a href="mailbox.html">Mailbox</a></li>
                                <li class="divider"></li>
                                <li><a href="login.html">Logout</a></li>
                            </ul>
                        </div>
                    </li>
                    <li class="active">
                        <a href="#home" data-toggle="tab">
                            <i class="fa fa-diamond"></i> <span class="nav-label">Home</span>
                        </a>
                    </li>
                    <li>
                        <a href="#simulation" data-toggle="tab">
                            <i class="fa fa-flask"></i> <span class="nav-label">Simulation</span>
                        </a>
                    </li>
                    <li>
                        <a href="#result" data-toggle="tab">
                            <i class="fa fa-bar-chart-o"></i> <span class="nav-label">Result</span>
                            <span class="label label-primary pull-right">NEW</span>
                        </a>
                    </li>
                    <li>
                        <a href="#help" data-toggle="tab">
                            <i class="fa fa-question-circle"></i> <span class="nav-label">Help</span>
                        </a>
                    </li>
                </ul>

            </div>
        </nav>

        <div id="page-wrapper" class="gray-bg tab-content">
            <!-- Home Page -->
            <div role="tabpanel" class="tab-pane active" id="home">
                <div class="row wrapper border-bottom white-bg page-heading">
                    <div class="col-lg-10">
                        <h2>Welcome to Tongji Traffic Simulator!</h2>
                    </div>
                </div>
                <br/>
                <div>
                    <div class="row">
                        <div class="col-lg-8">
                            <div class="ibox float-e-margins">
                                <div class="ibox-title">
                                    <h5>地图选择设置</h5>
                                    <span class="label label-primary pull-right">Map Related</span>
                                    <!-- Nav tabs -->
                                    <ul class="nav nav-tabs title-nav-tabs pull-right">
                                        <li class="active"><a href="#preset-map" data-toggle="tab">预设地图</a></li>
                                        <li><a href="#custom-map" data-toggle="tab">自定义地图</a></li>
                                    </ul>
                                </div>
                                <div class="ibox-content">
                                    <!-- Tab panes -->
                                    <div class="tab-content">
                                        <div class="tab-pane active" id="preset-map">
                                            <p>选择生成的地图样式 <code>地图样式</code></p>
                                            <button type="button" class="btn btn-primary" data-container="body" data-toggle="popover" data-placement="top" data-content="Vivamus sagittis lacus vel augue laoreet rutrum faucibus." data-original-title="" title="">
                                                单交叉口 +
                                            </button>
                                            <!--<button type="button" class="btn btn-primary" data-container="body" data-toggle="popover" data-placement="top" data-content="Vivamus sagittis lacus vel augue laoreet rutrum faucibus." data-original-title="" title="">-->
                                                <!--井字形交叉口 #-->
                                            <!--</button>-->
                                            <!--<button type="button" class="btn btn-primary" data-container="body" data-toggle="popover" data-placement="top" data-content="Vivamus sagittis lacus vel augue laoreet rutrum faucibus." data-original-title="" title="">-->
                                                <!--干线四交叉口 -+-+-+-+--->
                                            <!--</button>-->
                                        </div>
                                        <div class="tab-pane" id="custom-map">
                                            <button type="button" class="btn btn-primary">编辑地图</button>
                                            <button type="button" class="btn btn-primary">加载JSON</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-4">
                            <div class="ibox float-e-margins">
                                <div class="ibox-title">
                                    <span class="label label-success pull-right">model</span>
                                    <h5>跟车模型</h5>
                                </div>
                                <div class="ibox-content">
                                    <h1 class="no-margins">智能跟车模型</h1><br>
                                    <div class="stat-percent font-bold text-success">wiki<i class="fa fa-bolt"></i></div>
                                    <small>Total income</small>
                                </div>
                            </div>
                        </div>


                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-3">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                                <h5>仿真周期设置</h5>
                                <span class="label text-success pull-right">Time Related</span>
                            </div>
                            <div class="ibox-content">
                                <input id="sim-time" type="number" class="form-control" placeholder="仿真时间长度 ...">
                                <div class="stat-percent font-bold text-success">min <i class="fa fa-clock-o"></i></div>
                                <small>单位</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                                <span class="label label-info pull-right">max speed</span>
                                <h5>最大车速</h5>
                            </div>
                            <div class="ibox-content">
                                <input id="max-car-speed" type="number" class="form-control" placeholder="最大车速 ...">
                                <div class="stat-percent font-bold text-info">km/h <i class="fa fa-level-up"></i></div>
                                <small>单位</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                                <span class="label label-primary pull-right">maxAcceleration</span>
                                <h5>最大加速度</h5>
                            </div>
                            <div class="ibox-content">
                                <input id="max-car-Acceleration" type="number" class="form-control" placeholder="最大加速度 ...">
                                <div class="stat-percent font-bold text-navy">m2/s <i class="fa fa-level-up"></i></div>
                                <small>单位</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                                <span class="label label-danger pull-right">maxDeceleration</span>
                                <h5>最大减速度</h5>
                            </div>
                            <div class="ibox-content">
                                <input id="max-car-Deceleration" type="number" class="form-control" placeholder="最大加速度 ...">
                                <div class="stat-percent font-bold text-danger">m2/s<i class="fa fa-level-down"></i></div>
                                <small>单位</small>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">

                    <div class="col-lg-12   ">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                                <h5>信号控制相关</h5>
                                <span class="label label-success pull-right">Signal Related</span>
                            </div>
                            <div class="ibox-content">
                                <div class="row form-group">
                                    <div class="col-sm-3">
                                        <label class="control-label">定时控制</label>
                                        <p><code>信号周期</code></p>
                                        <input id="signal-cycle" type="number" class="form-control" placeholder="信号周期 ...">
                                        <br>
                                        <p><code>黄灯时间</code></p>
                                        <input id="yellow-time" type="number" class="form-control" placeholder="黄灯时间 ...">
                                        <br>
                                        <button id="set-signal" class="btn btn-success " type="button" onclick="set_signal()"><i class="fa fa-upload"></i>&nbsp;&nbsp;<span class="bold">Submit</span></button>
                                    </div>
                                    <div class="col-sm-9">
                                        <div class="row">
                                            <div class="col-sm-2"><span class="label pull-left label-primary">东西直行 <i class="fa fa-exchange"></i></span></div>
                                            <div class="col-sm-10"><input type="text" id="signal1" name="example_name" value="" /></div>

                                        </div><br>
                                        <div class="row">
                                            <div class="col-sm-2"><span class="label pull-left label-info">东西左转 <i class="fa fa-reply"></i></span></div>
                                            <div class="col-sm-10"><input type="text" id="signal2" name="example_name" value="" /></div>

                                        </div><br>
                                        <div class="row">
                                            <div class="col-sm-2"><span class="label pull-left label-warning">南北直行 <i class="fa fa-exchange"></i></span></div>
                                            <div class="col-sm-10"><input type="text" id="signal3" name="example_name" value="" /></div>

                                        </div><br>
                                        <div class="row">
                                            <div class="col-sm-2"><span class="label pull-left label-danger">南北左转 <i class="fa fa-reply"></i></span></div>
                                            <div class="col-sm-10"><input type="text" id="signal4" name="example_name" value="" /></div>

                                        </div><br>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                </div>

                <div class="row">
                    <div class="col-lg-9">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                                <h5>车流量设置</h5>
                                <span class="label label-warning pull-right">car producer Related</span>
                            </div>
                            <div class="ibox-content">
                                <div class="row form-group">

                                    <div class="col-sm-4">
                                        <label class="control-label"><p><code>左转车流量</code></p></label>
                                        <input id="left-car" type="number" class="form-control" placeholder="左转车流 ...">
                                        <div class="stat-percent font-bold text-navy">vel/h <i class="fa fa-car"></i></div>
                                        <small>单位</small>
                                    </div>

                                    <div class="col-sm-4">
                                        <label class="control-label"><p><code>直行车流量</code></p></label>
                                        <input id="straight-car" type="number" class="form-control" placeholder="自行车流 ...">
                                        <div class="stat-percent font-bold text-navy">vel/h <i class="fa fa-car"></i></div>
                                        <small>单位</small>
                                    </div>

                                    <div class="col-sm-4">
                                        <label class="control-label"><p><code>左转车流量</code></p></label>
                                        <input id="right-car" type="number" class="form-control" placeholder="左转车流 ...">
                                        <div class="stat-percent font-bold text-navy">vel/h <i class="fa fa-car"></i></div>
                                        <small>单位</small>
                                    </div>




                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3">

                        <div class="ibox-title">
                            <h5>仿真操作</h5>
                            <span class="label label-danger pull-right">start simulator</span>
                        </div>
                        <div class="ibox-content">
                            <button id="start-sim" class="btn btn-success " type="button" onclick="set_signal()"><i class="fa fa-arrow-right"></i>&nbsp;&nbsp;<span class="bold">开始仿真</span></button>
                        </div>


                    </div>
                </div>


            </div>

            <!-- Simulation Page -->
            <div role="tabpanel" class="tab-pane" id="simulation">
                <div class="row">
                    <div id="simulation-canvas"></div>
                    <div class="simulation-param ibox-content">
                        <div class="m-b" style="line-height: 32px">
                            <label for="running">Running</label>
                            <span class="pull-right">
                                <input type="checkbox" name="running" class="js-running" checked />
                            </span>
                        </div>
                        <div class="m-b">
                            <label>Generate</label>
                            <button id="generate-single" class="btn btn-sm btn-primary">Single</button>
                            <button id="generate-complex" class="btn btn-sm btn-primary">Complex</button>
                        </div>
                        <div class="m-b">
                            <label>Cars Number</label>
                            <input type="text" id="cars_number" data-min="0" data-max="200" data-from="10">
                        </div>
                        <div class="m-b">
                            <label>Scale</label>
                            <input type="text" id="scale" data-min="0.1" data-max="2" data-from="1" data-step="0.01">
                        </div>
                        <div class="m-b">
                            <label>Time Factor</label>
                            <br>
                            <input type="text" id="timeFactor" value="5"
                                data-min="0.1" data-max="10" data-step="0.1" data-width="85" data-height="85">
                        </div>
                        <div class="m-b">
                            <label>Lights Flip Interval</label>
                            <br>
                            <input type="text" id="lightsFlipIntervalGreen" value="10" data-fgcolor="#1AB394"
                                data-min="0" data-max="50" data-step="0.01" data-width="85" data-height="85">
                            <input type="text" id="lightsFlipIntervalRed" value="10" data-fgcolor="#ED5565"
                                data-min="0" data-max="50" data-step="0.01" data-width="85" data-height="85">
                        </div>
                    </div>
                </div>
                <div class="row gray-bg simulation-graph">
                    <div class="col-sm-6">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                                <h5>Moving Chart</h5>
                            </div>
                            <div class="ibox-content">
                                <div class="flot-chart">
                                    <div class="flot-chart-content" id="flot-line-chart-moving"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                                <h5>Static Chart</h5>
                            </div>
                            <div class="ibox-content">
                                <div class="flot-chart">
                                    <div class="flot-chart-content" id="flot-bar-chart"></div>
                                </div>
                           </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Result Page -->
            <div role="tabpanel" class="tab-pane" id="result">
                <div class="row wrapper border-bottom white-bg page-heading">
                    <div class="col-lg-10">
                        <h2>Simulation Result</h2>
                    </div>
                </div>
            </div>

            <!-- Help Page -->
            <div role="tabpanel" class="tab-pane" id="help">
                <div class="row wrapper border-bottom white-bg page-heading">
                    <div class="col-lg-10">
                        <h2>Help</h2>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <link rel="stylesheet" href="css/custom.css" />
    <link rel="stylesheet" href="css/animate.css" />
    <link rel="stylesheet" media="screen" href="css/plugins/handsonTable/handsontable.full.css">

<!--    <script src="js/inspinia.js"></script>-->

    <!-- Mainly scripts -->
    <script src="js/jquery-2.1.1.js"></script>
    <script src="js/bootstrap.min.js"></script>

    <!-- Flot -->
    <script src="js/plugins/flot/jquery.flot.js"></script>
    <script src="js/plugins/flot/jquery.flot.tooltip.min.js"></script>
    <script src="js/plugins/flot/jquery.flot.resize.js"></script>
    <script src="js/plugins/flot/jquery.flot.pie.js"></script>
    <script src="js/plugins/flot/jquery.flot.time.js"></script>

    <!-- Form -->
    <script src="js/plugins/switchery/switchery.js"></script>
    <script src="js/plugins/ionRangeSlider/ion.rangeSlider.min.js"></script>
    <script src="js/plugins/jsKnob/jquery.knob.js"></script>
    <script src="js/plugins/iCheck/icheck.min.js"></script>
    <script src="js/plugins/pace/pace.min.js"></script>
    <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

    <script src="js/plugins/handsonTable/handsontable.full.js"></script>

    <script type="text/javascript">

    var world = window.world;
    var visualizer = window.visualizer;
    var settings = window.settings;


    var signalSettings = {};

    var mapJson = {};

    // 解析json的map
    function UploadAndParseJsonMap(){}


$(function() {


    var elem = document.querySelector('.js-running');
    var isRunning = new Switchery(elem, { color: '#1AB394' });
    elem.addEventListener('change', function () {
        visualizer.running = this.checked;
    });

    $('#generate-single').click(function () {
        visualizer.previousTime = 0;
        world.generateSingleCrossRoadMap();
        visualizer.start()
    });
    $('#generate-complex').click(function () {
        visualizer.previousTime = 0;
        world.generateCrossRoadMap();
        visualizer.start()
    });

    $('#cars_number').ionRangeSlider({
        onChange: function (v) { world.carsNumber = v.from; }
    });
    $('#scale').ionRangeSlider({
        onChange: function (v) { visualizer.zoomer.scale = v.from; }
    });

    $("#timeFactor").knob({
        'release' : function (v) { visualizer.timeFactor = v; }
    });
    $("#lightsFlipIntervalGreen").knob({
        'release' : function (v) { settings.lightsFlipInterval = v; }
    });
    $("#lightsFlipIntervalRed").knob({
        'release' : function (v) { settings.lightsFlipInterval = v; }
    });

    var container = $("#flot-line-chart-moving");

    // Determine how many data points to keep based on the placeholder's initial size;
    // this gives us a nice high-res plot while avoiding more than one point per pixel.

    var maximum = container.outerWidth() / 2 || 300;

    //

    var data = [];

    function getRandomData() {

        if (data.length) {
            data = data.slice(1);
        }

        while (data.length < maximum) {
            var y = world.instantSpeed;
            data.push(y < 0 ? 0 : y > 100 ? 100 : y);
        }

        // zip the generated y values with the x values

        var res = [];
        for (var i = 0; i < data.length; ++i) {
            res.push([i, data[i]])
        }

        return res;
    }

    series = [{
        data: getRandomData(),
        lines: {
            fill: true
        }
    }];


    var plot = $.plot(container, series, {
        grid: {

            color: "#999999",
            tickColor: "#D4D4D4",
            borderWidth:0,
            minBorderMargin: 20,
            labelMargin: 10,
            backgroundColor: {
                colors: ["#ffffff", "#ffffff"]
            },
            margin: {
                top: 8,
                bottom: 20,
                left: 20
            },
            markings: function(axes) {
                var markings = [];
                var xaxis = axes.xaxis;
                for (var x = Math.floor(xaxis.min); x < xaxis.max; x += xaxis.tickSize * 2) {
                    markings.push({
                        xaxis: {
                            from: x,
                            to: x + xaxis.tickSize
                        },
                        color: "#fff"
                    });
                }
                return markings;
            }
        },
        colors: ["#1ab394"],
        xaxis: {
            tickFormatter: function() {
                return "";
            }
        },
        yaxis: {
            min: 0,
            max: 10
        },
        legend: {
            show: true
        }
    });

    // Update the random dataset at 25FPS for a smoothly-animating chart

    setInterval(function updateRandom() {
        series[0].data = getRandomData();
        plot.setData(series);
        plot.draw();
    }, 1000);

});

$(function() {
    var barOptions = {
        series: {
            bars: {
                show: true,
                barWidth: 0.6,
                fill: true,
                fillColor: {
                    colors: [{
                        opacity: 0.8
                    }, {
                        opacity: 0.8
                    }]
                }
            }
        },
        xaxis: {
            tickDecimals: 0
        },
        colors: ["#1ab394"],
        grid: {
            color: "#999999",
            hoverable: true,
            clickable: true,
            tickColor: "#D4D4D4",
            borderWidth:0
        },
        legend: {
            show: false
        },
        tooltip: true,
        tooltipOpts: {
            content: "x: %x, y: %y"
        }
    };
    var barData = {
        label: "bar",
        data: [
            [1, 34],
            [2, 25],
            [3, 19],
            [4, 34],
            [5, 32],
            [6, 44]
        ]
    };
    $.plot($("#flot-bar-chart"), [barData], barOptions);

});

var single_time;
var circle_time = 150;
var yellow_time = 2;
var single_array = [];

function set_signal() {

    circle_time =  $("#signal-cycle").val();
    yellow_time = $("#yellow-time").val();

    $("#signal1").data("ionRangeSlider").update({
        max: circle_time
    });
    $("#signal2").data("ionRangeSlider").update({
        max: circle_time
    });
    $("#signal3").data("ionRangeSlider").update({
        max: circle_time
    });
    $("#signal4").data("ionRangeSlider").update({
        max: circle_time
    });

}


$(function(){


    $("#signal1").ionRangeSlider({
        grid: true,
        type: "double",
        min: 0,
        max: circle_time,
        from: 0,
        postfix: " s",
        decorate_both: false,
        values_separator: " to ",

        onFinish:  function (data) {

            var slider = $("#signal2").data("ionRangeSlider");
            // Call sliders update method with any params
            slider.update({
                from: data.to + parseInt(yellow_time)
            });


        }
    });
    $("#signal2").ionRangeSlider({
        grid: true,
        type: "double",
        min: 0,
        max: circle_time,
        from: 0,
        postfix: " s",
        decorate_both: false,
        values_separator: " to ",

        onFinish:  function (data) {

            var slider = $("#signal3").data("ionRangeSlider");
            // Call sliders update method with any params
            slider.update({
                from: data.to + parseInt(yellow_time)
            });

        }

    });
    $("#signal3").ionRangeSlider({
        grid: true,
        type: "double",
        min: 0,
        max: circle_time,
        from: 0,
        postfix: " s",
        decorate_both: false,
        values_separator: " to ",

        onFinish:  function (data) {

            var slider = $("#signal4").data("ionRangeSlider");
            // Call sliders update method with any params
            slider.update({
                from: data.to + parseInt(yellow_time)
            });

        }
    });

    $("#signal4").ionRangeSlider({
        grid: true,
        type: "double",
        min: 0,
        max: circle_time,
        from: 0,
        to: circle_time,
        postfix: " s",
        decorate_both: false,
        values_separator: " to "
    });


});


    </script>
</body>
</html>
